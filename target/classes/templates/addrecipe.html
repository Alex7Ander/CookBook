<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">	
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" th:href="@{/styles/style.css}" href="../static/styles/style.css" type="text/css">
		<link rel="stylesheet" th:href="@{/styles/add_recipe_style.css}" href="../static/styles/add_recipe_style.css" type="text/css">
		<link rel="stylesheet" th:href="@{/styles/pop_up.css}" href="../static/styles/pop_up.css" type="text/css">
		<script th:src="@{/js/jquery-3.4.1.js}" src="../static/js/jquery-3.4.1.js"></script>
		<script th:src="@{/js/asyncRequest.js}" src="../static/js/asyncRequest.js"></script>
		<script th:src="@{/js/ingredient.js}" src="../static/js/ingredient.js"></script>				
		<script>
			$(document).ready(function(){
				//Скрыть PopUp при загрузке страницы    
				PopUpHide();
			});
			//Функция отображения PopUp
			function PopUpShow(){
				$("#add_ingr_popup").show();
			}
			//Функция скрытия PopUp
			function PopUpHide(){
				$("#add_ingr_popup").hide();
			}
			function DeleteIngr(){
				
			}
		</script>
		<title>Новый рецепт</title>	
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	</head>
	<body>
		<nav style="background-color: rgb(128, 128, 0, 0.7)" class="navbar navbar-expand-lg navbar-default navbar-fixed-top" > 
			<a class="navbar-brand" href="#">CookBook</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item ">
						<a class="nav-link" href="/user/cookbook">В книгу рецептов</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/user/editpersonal">Редактировать информацию о себе</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/user/personal">На свою страницу</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/user/ingredients">Ингридиенты</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/user/reviewbook">Книга отзывов</a>
					</li>
				</ul>
			</div>
			<div style="float: left">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item">
						<a class="nav-link" href="/logout">Выход</a>
					</li>
				</ul>
			</div>
		</nav>	
		<div class="main_info_conteiner">		
			<form id="saverecipeform" method="post" action="saverecipe">					
				<h4>Основная информация</h4><br>
				<b>Название:</b><br>
				<input type = "text" name = "name" placeholder = "Название рецепта"><br>
				<b>Категория:</b><br>
				<select>
					<option>Горячие блюда</option>
					<option>Гарниры</option>
					<option>Закуски</option>
					<option>Салаты</option>
					<option>Десерты</option>
					<option>Напитки</option>
					<option>Fast food</option>
				</select>
				<b>Слоган:</b><br>
				<input type = "text" name = "tagline" placeholder = "Слоган"><br>	
				<b>Ссылка на youtube:</b><br>
				<input form="saverecipeform" type = "text" name="youtubelink" placeholder = "https://www.youtube.com/..."></input><br>				
			</form>	
		</div>
		
		<div class="text_container">	
			<b>Алгоритм: </b><br>
			<textarea name="text" cols=170 rows=10>Итак, </textarea>									
		</div>
		
		<div>		
			<table id="ingrTable">
				<tr>
					<th colspan = "3"><b>Ингридиенты</b></th>
				</tr>
				<tr>
					<th><b>Ингридиенты</b></th>
					<th><b>Количество (гр/мл)</b></th>
					<th><b>Управление</b></th>
				</tr>
				<tr th:each="ingredient : ${recipeIngredients}">
					<td><span th:text="${ingredient.name}"> - </span></td>
					<td><input type="text"></input></td>
					<td>
						<a href="javascript:DeleteIngr()">Удалить</a>
					</td>
				</tr>
				
				<tr>
					<th colspan="3"><a href="javascript:PopUpShow()">Добавить</a></th>
				<tr>
			</table>
		</div>	
		
		<div class="photo_conteiner">
			<table>
				<tr>
					<th colspan="6">Фото</th>
				</tr>
				<tr>
					<td> <img th:src="@{/img/noimg.png}" src="../static/img/noimg.png" /> </td>
					<td> <img th:src="@{/img/noimg.png}" src="../static/img/noimg.png" /> </td>
					<td> <img th:src="@{/img/noimg.png}" src="../static/img/noimg.png" /> </td>
					<td> <img th:src="@{/img/noimg.png}" src="../static/img/noimg.png" /> </td>
					<td> <img th:src="@{/img/noimg.png}" src="../static/img/noimg.png" /> </td>
					<td> <img th:src="@{/img/noimg.png}" src="../static/img/noimg.png" /> </td>
				</tr>
				<tr>
					<td> <button class = "dws-btn" type="submit">+</button> </td>
					<td> <button class = "dws-btn" type="submit">+</button> </td>
					<td> <button class = "dws-btn" type="submit">+</button> </td>
					<td> <button class = "dws-btn" type="submit">+</button> </td>
					<td> <button class = "dws-btn" type="submit">+</button> </td>
					<td> <button class = "dws-btn" type="submit">+</button> </td>
				</tr>
			</table>			
		</div>
		<button form="saverecipeform" class = "dws-btn" type="submit"> Сохранить </button>
		
	<!-- Pop up window for adding ingredient -->
		<div class="popup" id="add_ingr_popup">				
			<div class="popup-content">
				<div>
					<form id="addIngr" method="post" action="addIngrToList"> </form>
					<b>Выбрать ингридиент</b><br>
					
					<b>Категория ингридиента:</b><br>
					<select id="ingrType" name="type">
						<option value="none" hidden="">Выберите тип</option>
						<option th:each="type : ${ingrTypes}"> <b th:text=${type}> - </b> </option>
					</select>
					<input type="button" onclick="getIngrListFromServer()" value="Выбрать"/><br>
					
					<b>Ингридиенты:</b><br>
					<div id="ingrList">
					<select id="ingrName">
						<option value="none" hidden="">Выберите игредиент</option>
						<option th:each="ingr : ${ingredients}"> <p th:text=${ingr.name}> - </p> </option>
					</select>
					</div><br>
					<a href="javascript:addToTableExistingIngr()">Добавить</a>
					/
					<a href="javascript:PopUpHide()">Отмена</a>					
				</div>
				<div>
					<form>
					<b>Добавить новый ингридиент</b><br>
					<b>Имя:</b><br>
					<input type = "text" id="newIngrName" name = "name" placeholder = "Имя"><br>
					<b>Тип:</b><br>
					<input type = "text" id="newIngrType" name = "type" placeholder = "Тип"><br>	
					<b>Белки:</b><br>
					<input type = "text" id="newIngrProt" name = "prot" placeholder = "Белки / 100гр"><br>
					<b>Жиры:</b><br>
					<input type = "text" id="newIngrFat" name = "fat" placeholder = "Жиры / 100 гр"><br>
					<b>Углеводы:</b><br>
					<input type = "text" id="newIngrCarbo" name = "carbo" placeholder = "Углеводы / 100 гр"><br>
					<b>Описание:<b></br>
					<textarea id="newIngrDesription" name="descr" cols=20 rows=7> - </textarea><br>
					<a href="javascript:saveNewIngredient()">Сохранить новый и добавить его к рецепту</a>
					/
					<a href="javascript:PopUpHide()">Отмена</a>
					</form>
				</div>
			</div>
			
			<!-- AJAX script -->
			<script>
			function getIngrListFromServer(){
				req = new asyncRequest();
				element = document.getElementById('ingrList');
				req.onreadystatechange = function() {
					if (req.readyState == 4) {
						element.innerHTML = req.responseText;
						if(!req.status == 200) {
							alert("Error: " + req.status);
						}
					}
				}
				var select = document.getElementById("ingrType");
				var selectedValue = select.value;
				var body = "?type=" + selectedValue;			
				req.open("GET", "/user/getIngrList" + body);
				req.send();
				element.innerHTML = "Ожидаю ответа сервера...";
			}
			
			function saveNewIngredient(){
				var name = document.getElementById("newIngrName").value;
				var type = document.getElementById("newIngrType").value; 
				var descr = document.getElementById("newIngrDesription").value;
				var prot = document.getElementById("newIngrProt").value;
				var fat = document.getElementById("newIngrFat").value;
				var carbo = document.getElementById("newIngrCarbo").value;
				var ingr = new ingredient(name, type, descr, prot, fat, carbo);
				ingr.save();
				if (ingr.isSaved() == true) {
					ingr.addToTable('ingrTable');
					PopUpHide();
				}
			}
			
			function addToTableExistingIngr(){
			
			
			}
			</script>			
		</div>
		
	</body>
</html>